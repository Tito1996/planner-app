<div class="events-calendar">
  <div class="calendar-wrapper">
    <mwl-calendar-month-view
      [viewDate]="viewDate"
      [events]="events"
      [activeDayIsOpen]="false"
      [cellTemplate]="cellTemplate"
      (dayClicked)="onDayClick($event.day)"
    ></mwl-calendar-month-view>
  </div>

  <ng-template #cellTemplate let-day="day">
    <div class="mini-cell">
      <span class="mini-day">{{ day.date | date: 'd' }}</span>
      <div
        class="event-dot"
        *ngIf="day.events?.length"
        [style.backgroundColor]="day.events[0]?.color?.primary"
      ></div>
    </div>
  </ng-template>

  <div class="event-wrapper">
    <div class="side-panel">
      <ng-container *ngIf="selectedDayEvents?.length; else createForm">
        <h4>Eventos del {{ selectedDate | date: 'longDate' }}</h4>
        <ul>
          <li *ngFor="let event of selectedDayEvents">
            {{ event.title }} – {{ event.start | date: 'shortTime' }}
          </li>
        </ul>

        <button (click)="showForm = true">+ Agregar evento</button>

    <div *ngIf="showForm">
      <form (ngSubmit)="addEvent()">
        <input
          type="text"
          placeholder="Título"
          [(ngModel)]="newEvent.title"
          name="title"
          required
        />
        <input
          type="time"
          [(ngModel)]="newEvent.time"
          name="time"
          required
        />
        <button type="submit">Guardar</button>
      </form>
    </div>
      </ng-container>

      <ng-template #createForm>
        <h4>Crear nuevo evento para {{ selectedDate | date: 'longDate' }}</h4>
        <form (ngSubmit)="addEvent()">
          <input type="text" placeholder="Título" [(ngModel)]="newEvent.title" name="title" required />
          <input type="time" [(ngModel)]="newEvent.time" name="time" required />
          <button type="submit">Agregar</button>
        </form>
      </ng-template>
    </div>
  </div>
</div>
